title: decrypt
signature:
  - inputs: [ key, envelope ]
    output: plaintext
variables:
  key:
    type: "[`SymmetricKey`]() | [`SharedKey`]()"
    description: |
      Key to be used in the encryption operation.
  envelope:
    type: "[`Envelope`]()"
    description: |
      Container class for encryption products, `ciphertext` and `nonce`. As returned by [`encrypt`]().
  plaintext:
    type: "[`Uint8Array`]()"
    description: |
      The decrypted ciphertext.

prose: |
  A [generic function]() accepting an encryption key and ciphertext to output a plaintext.  `decrypt` and its counterpart [`encrypt`]() form a pair of opposing operations.

  Panda-Confidential establishes a key type system to determine your intention in a clear and error-free way.  That allows `decrypt`'s behavior to depend on the input key:
   - When given a [`SymmetricKey`](), `decrypt` uses [symmetric decryption]().
   - When given a [`SharedKey`](), `decrypt` uses authenticated, [asymmetric decryption]().

  Ciphertext is enclosed in the special container, [`Envelope`](), provided by [`encrypt`]().  If you wish to instanciate an `Envelope` from a serialized form, use the type method `Envelope.from` to do so.

  `decrypt` is agnostic about the data it processes, outputting a [`Uint8Array`]() byte array.  [`convert`]() may then be used to explicitly specify a data encoding.

examples:
  - title: Symmetric Decryption
    content: |
      ```coffeescript
      import assert from "assert"
      import {confidential} from "panda-confidential"
      {decrypt, Envelope, convert} = confidential()
      import {keyLookup, read} from "my-library"

      do ->
        alice = keyLookup "Alice/private"
        serialized = read "greeting"
        envelope = Envelope.from "base64", serialized
        plaintext = await decrypt alice, envelope

        assert.equal (convert from: "bytes", to: "utf8", plaintext),
          "Hello, Alice!"
      ```
  - title: Asymmetric Decryption
    content: |
      ```coffeescript
      import assert from "assert"
      import {confidential} from "panda-confidential"
      {SharedKey, decrypt, Envelope, convert} = confidential()
      import {keyLookup, receive} from "my-library"

      do ->
        alice = keyLookup "Alice/public"
        bob = keyLookup "Bob/private"
        toBobFromAlice = SharedKey.create alice, bob
        serialized = receive "Bob"
        envelope = Envelope.from "base64", serialized
        plaintext = await decrypt toBobFromAlice, envelope

        assert.equal (convert from: "bytes", to: "utf8", plaintext),
          "Hello, Bob!"
      ```

title: sign
signature:
  - inputs: [ public-key, private-key, data ]
    output: [ declaration ]
  - inputs: [ private-key, public-key, data ]
    output: [ declaration ]
  - inputs: [ key-pair, data ]
    output: [ declaration ]
variables:
  key-pair:
    type: "[`SignatureKeyPair`]()"
    description: |
      The public and private keys with which to sign `data`.
  public-key:
    type: "[`PublicKey`]()"
    description: |
      The public key of the person wishing to sign `data`.
  private-key:
    type: "[`PrivateKey`]()"
    description: |
      The private key of the person wishing to sign `data`.
  data:
    type: "[`Uint8Array`]() | [`Buffer`]() | [`Declaration`]()"
    description: |
      Data to be signed.
  declaration:
    type: "[`Declaration`]()"
    description: |
      Object with properties `data`, `signatures`, and `signatories`. Suitable for use with `verify`.

prose: |
  A [generic function]() accepting signing keys and data to output a cryptographic signature.  `sign` and its counterpart [`verify`]() form a pair of opposing operations.

  Panda-Confidential establishes a key type system to determine your intention in a clear and error-free way.  That allows `sign` to accept either a signing keypair or the signing keys individually.

  > **Warning**: Encryption key pairs are incompatible with `sign` and will cause `sign` to throw.

  The output is a special container object, [`Declaration`](), and is expected by [`verify`]().  `Declaration` holds the original data, the public keys of the `signatories`, and the `signatures` that attest the integrity of the data and the irrefutablitiy of the given signatory.

  The `Declaration` object is also a valid input to `sign` and cause it to append a signature to the existing list.

examples:
  - title: Single Signature
    content: |
      ```coffeescript
      import {confidential} from "panda-confidential"
      {sign} = confidential()

      import {send, keyPairLookup} from "my-library"

      do ->
        alice = keyPairLookup "Alice/signature"
        greeting = sign alice, "Hello, World!"

        # encode the signed data object itself
        send "Bob", convert to: "safe-base64", declaration
      ```

  - title: Multiple Signatures
    content: |
      `sign` supports multiple signatories.  Provide a [`Declaration`]() object to the `data` argument and `sign` will append the signature to the `Declaration` in the output. The `signatures` property contains a list of signatures. The `signatories` property contains a list of the corresponding public keys.

      ```coffeescript
      import assert from "assert"
      import {confidential} from "panda-confidential"
      {sign, declaration} = confidential()
      import {receive, keyPairLookup} from "my-library"

      do ->
        # convert JSON to declaration
        greeting = declaration convert from: "json", receive "Bob"

        # add Bob's signature
        bob = keyPairLookup "Bob/signature"
        greeting = sign bob, greeting

        assert.equal greeting.signatures.length, 2
        assert.equal greeting.signatories.length, 2
      ```
